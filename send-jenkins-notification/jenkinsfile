pipeline {
    agent any

    stages {
        stage('Check out codebase') {
            steps {
                // Note: 'checkout scm' uses the pipeline-defined repo, remove if unnecessary
                checkout([$class: 'GitSCM', 
                          branches: [[name: '*/main']],
                          userRemoteConfigs: [[
                              credentialsId: 'github-ssh-key', // Ensure this is configured properly
                              url: 'https://github.com/poonamg1524/slack-notifications.git'
                          ]]
                ])
            }
        }

        stage('Build') {
            steps {
                echo 'Building Codebase'
                // Use `bat` if there's a real build step like compiling
                // bat 'go build .'
            }
        }

        stage('Test') {
            steps {
                echo 'Running Tests on changes'
                // Example: bat 'go test ./...'
            }
        }

        stage('Deploy') {
            steps {
                echo 'Done!'

                // Use bat instead of sh for Windows
                bat "go run send-jenkins-notification\\slack-notification.go %BUILD_URL% %currentBuild.currentBuildResult% %BUILD_NUMBER% %JOB_NAME%"
            }
        }
    }
}
