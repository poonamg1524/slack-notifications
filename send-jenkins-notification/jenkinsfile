pipeline {
    agent any

    stages {
        stage('Check out codebase') {
            steps {
                checkout([$class: 'GitSCM', 
                          branches: [[name: '*/main']],
                          userRemoteConfigs: [[
                              credentialsId: 'github-ssh-key', // Ensure this credential exists in Jenkins
                              url: 'https://github.com/poonamg1524/slack-notifications.git'
                          ]]
                ])
            }
        }

        stage('Build') {
            steps {
                echo 'Building Codebase'
                // Example: bat 'go build .'
            }
        }

        stage('Test') {
            steps {
                echo 'Running Tests on changes'
                // Example: bat 'go test ./...'
            }
        }

        stage('Deploy') {
            steps {
                echo 'Done!'

                // Proper environment variable usage for Windows in Jenkins
                bat "go run send-jenkins-notification\\slack-notification.go ${env.BUILD_URL} ${currentBuild.currentResult} ${env.BUILD_NUMBER} ${env.JOB_NAME}"
            }
        }
    }
}
